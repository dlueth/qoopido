/**! @qoopido/emitter 1.0.0 | https://github.com/dlueth/qoopido | (c) 2020 Dirk Lueth */
import{isString as t,isRegExp as e,isArray as n,isFunction as i,isTypeof as r,isThenable as s}from"@qoopido/validator";function c(t,e,n,i,r){this.identifier=e,this.callback=n,this.timestamp=i?t.timestamp=t.timestamp-1:+new Date,this.remaining=r}var a=new WeakMap;function l(t,e){Object.defineProperty(this,"name",{value:t,enumerable:!0,configurable:!1,writable:!1}),Object.defineProperty(this,"context",{value:e,enumerable:!0,configurable:!1,writable:!1}),a.set(this,{isCanceled:!1})}function o(i){return t(i)||e(i)||n(i)}l.prototype={cancel:function(){a.get(this).isCanceled=!0},get isCanceled(){return a.get(this).isCanceled}};var u=new WeakMap;function f(t){return u.set(t,{timestamp:+new Date,events:{},expressions:[]}),t}function h(t){return t.callback!==this}function p(t){return!(t.identifier.toString()===this.identifier.toString()&&(r(this.callback,"undefined")||t.callback===this.callback))}function m(t,e){return t.timestamp-e.timestamp}function d(t){return t.callback}function v(t,e,n){var i=this;t.reduce((function(t,r){if(!e.isCanceled)return r.remaining&&!(r.remaining-=1)&&i.off(r.identifier,r.callback),s(t)?t.then((function(){return r.callback.apply(this,[e].concat(n))})):r.callback.apply(this,[e].concat(n))}),!0)}function b(t,e,n,i){(this.events[t]=this.events[t]||[]).push(new c(this,t,e,n,i))}function g(t,e){this.events[t]&&(e?this.events[t]=this.events[t].filter(h,e):this.events[t].length=0)}function k(t,e,n,i){this.expressions.push(new c(this,t,e,n,i))}function w(t,e){this.expressions=this.expressions.filter(p,{identifier:t,callback:e})}function y(e){var n,i;return t(e)&&(i=u.get(this),n=i.events[e]?i.events[e].slice():[],this!==x&&(n=n.concat(y.call(x,e))),i.expressions.forEach(t=>{t.identifier.test(e)&&n.push(t)}),n.sort(m)),n||[]}function x(){f(this)}x.prototype={emit:function(t){var e=Array.prototype.slice.call(arguments,1),n=y.call(this,t);return n.length&&v.call(this,n,new l(t,this),e),this},on:function(t,e,n,i){return x.on.call(this,t,e,n,i)},once:function(t,e,n){return x.once.call(this,t,e,n)},limit:function(t,e,n,i){return x.limit.call(this,t,e,n,i)},off:function(t,e){return x.off.call(this,t,e)},listener:function(t){return x.listener.call(this,t)}},x.on=function(r,s,c,a){if(o(r)&&i(s)){var l=u.get(this);t(r)&&b.call(l,r,s,c,a),e(r)&&k.call(l,r,s,c,a),n(r)&&r.forEach(t=>{this.on(t,s,c,a)})}return this},x.once=function(t,e,n){return this.on(t,e,n,1)},x.limit=function(t,e,n,i){return this.on(t,n,i,e)},x.off=function(s,c){if(o(s)&&(i(c)||r(c,"undefined"))){var a=u.get(this);t(s)&&g.call(a,s,c),e(s)&&w.call(a,s,c),n(s)&&s.forEach(t=>{this.off(t,c)})}return this},x.listener=function(t){return y.call(this,t).map(d)};var C=f(x);export default C;
//# sourceMappingURL=index.min.js.map
