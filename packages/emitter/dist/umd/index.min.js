/**! @qoopido/emitter 1.0.0 | https://github.com/dlueth/qoopido | (c) 2020 Dirk Lueth */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("@qoopido/validator")):"function"==typeof define&&define.amd?define(["@qoopido/validator"],i):(t=t||self)["@qoopido/emitter"]=i(t["@qoopido/validator"])}(this,(function(t){"use strict";function i(t,i,e,n,s){this.identifier=i,this.callback=e,this.timestamp=n?t.timestamp=t.timestamp-1:+new Date,this.remaining=s}var e=new WeakMap;function n(t,i){Object.defineProperty(this,"name",{value:t,enumerable:!0,configurable:!1,writable:!1}),Object.defineProperty(this,"context",{value:i,enumerable:!0,configurable:!1,writable:!1}),e.set(this,{isCanceled:!1})}function s(i){return t.isString(i)||t.isRegExp(i)||t.isArray(i)}n.prototype={cancel:function(){e.get(this).isCanceled=!0},get isCanceled(){return e.get(this).isCanceled}};var r=new WeakMap;function o(t){return r.set(t,{timestamp:+new Date,events:{},expressions:[]}),t}function c(t){return t.callback!==this}function a(i){return!(i.identifier.toString()===this.identifier.toString()&&(t.isTypeof(this.callback,"undefined")||i.callback===this.callback))}function l(t,i){return t.timestamp-i.timestamp}function u(t){return t.callback}function f(i,e,n){var s=this;i.reduce((function(i,r){if(!e.isCanceled)return r.remaining&&!(r.remaining-=1)&&s.off(r.identifier,r.callback),t.isThenable(i)?i.then((function(){return r.callback.apply(this,[e].concat(n))})):r.callback.apply(this,[e].concat(n))}),!0)}function h(t,e,n,s){(this.events[t]=this.events[t]||[]).push(new i(this,t,e,n,s))}function p(t,i){this.events[t]&&(i?this.events[t]=this.events[t].filter(c,i):this.events[t].length=0)}function d(t,e,n,s){this.expressions.push(new i(this,t,e,n,s))}function m(t,i){this.expressions=this.expressions.filter(a,{identifier:t,callback:i})}function g(i){var e,n;return t.isString(i)&&(n=r.get(this),e=n.events[i]?n.events[i].slice():[],this!==v&&(e=e.concat(g.call(v,i))),n.expressions.forEach(t=>{t.identifier.test(i)&&e.push(t)}),e.sort(l)),e||[]}function v(){o(this)}return v.prototype={emit:function(t){var i=Array.prototype.slice.call(arguments,1),e=g.call(this,t);return e.length&&f.call(this,e,new n(t,this),i),this},on:function(t,i,e,n){return v.on.call(this,t,i,e,n)},once:function(t,i,e){return v.once.call(this,t,i,e)},limit:function(t,i,e,n){return v.limit.call(this,t,i,e,n)},off:function(t,i){return v.off.call(this,t,i)},listener:function(t){return v.listener.call(this,t)}},v.on=function(i,e,n,o){if(s(i)&&t.isFunction(e)){var c=r.get(this);t.isString(i)&&h.call(c,i,e,n,o),t.isRegExp(i)&&d.call(c,i,e,n,o),t.isArray(i)&&i.forEach(t=>{this.on(t,e,n,o)})}return this},v.once=function(t,i,e){return this.on(t,i,e,1)},v.limit=function(t,i,e,n){return this.on(t,e,n,i)},v.off=function(i,e){if(s(i)&&(t.isFunction(e)||t.isTypeof(e,"undefined"))){var n=r.get(this);t.isString(i)&&p.call(n,i,e),t.isRegExp(i)&&m.call(n,i,e),t.isArray(i)&&i.forEach(t=>{this.off(t,e)})}return this},v.listener=function(t){return g.call(this,t).map(u)},o(v)}));
//# sourceMappingURL=index.min.js.map
